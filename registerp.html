<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Patient Registration - DHRMS</title>
    <link rel="stylesheet" href="registerp.css">
</head>
<body>
    <header class="main-header">
        <div class="header-content">
            <div class="header-logo">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Kerala_Government_Logo.svg/1200px-Kerala_Government_Logo.svg.png" alt="Logo" class="logo-small">
                <span>DHRMS Kerala</span>
            </div>
            <div class="header-user-info">
                <span>Welcome, Operator_101</span>
                <a href="#" class="logout-button">Logout</a>
            </div>
        </div>
    </header>

    <main class="form-container">
        <h1>New Patient Registration</h1>
        
        <div class="health-id-display">
            <strong>System Generated Health ID:</strong> <span>(Will be generated upon submission)</span>
        </div>

        <form action="#" method="POST" class="registration-form">
            <fieldset>
                <legend>Personal & Identification Details</legend>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" id="fullName" name="fullName" required>
                    </div>
                    <div class="input-group">
                        <label for="aadhaar">Aadhaar Number *</label>
                        <input type="text" id="aadhaar" name="aadhaar" pattern="\d{12}" title="12-digit Aadhaar number" required>
                    </div>
                    <div class="input-group">
                        <label for="dob">Date of Birth *</label>
                        <input type="date" id="dob" name="dob" required>
                    </div>
                    <div class="input-group">
                        <label for="age">Age</label>
                        <input type="text" id="age" name="age" disabled>
                    </div>
                    <div class="input-group">
                        <label for="gender">Gender *</label>
                        <select id="gender" name="gender" required>
                            <option value="">-- Select --</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="photo">Patient Photograph *</label>
                        <input type="file" id="photo" name="photo" accept="image/*" required>
                    </div>
                    <div class="input-group">
                        <label for="guardianName">Father's / Guardian's Name</label>
                        <input type="text" id="guardianName" name="guardianName">
                    </div>
                     <div class="input-group">
                        <label for="motherTongue">Mother Tongue</label>
                        <select id="motherTongue" name="motherTongue">
                            <option value="">-- Select --</option>
                            <option value="Malayalam">Malayalam</option>
                            <option value="Bengali">Bengali</option>
                            <option value="Odia">Odia</option>
                            <option value="Hindi">Hindi</option>
                            <option value="Assamese">Assamese</option>
                            <option value="Tamil">Tamil</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Origin & Contact Information</legend>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="mobile">Mobile Number *</label>
                        <input type="tel" id="mobile" name="mobile" pattern="\d{10}" title="10-digit mobile number" required>
                    </div>
                    <div class="input-group">
                        <label for="homeState">Home State *</label>
                        <select id="homeState" name="homeState" required>
                            <option value="">-- Select State --</option>
                            <option value="West Bengal">West Bengal</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="input-group full-width">
                        <label for="currentAddress">Current Address (in Kerala) *</label>
                        <textarea id="currentAddress" name="currentAddress" rows="3" required></textarea>
                    </div>
                     <div class="input-group">
                        <label for="district">District *</label>
                        <select id="district" name="district" required>
                             <option value="">-- Select District --</option>
                             <option value="Thiruvananthapuram">Thiruvananthapuram</option>
                             <option value="Kollam">Kollam</option>
                             <option value="Ernakulam">Ernakulam</option>
                             <option value="Kozhikode">Kozhikode</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="pincode">Pincode *</label>
                        <input type="text" id="pincode" name="pincode" pattern="\d{6}" required>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Initial Health Intake</legend>
                <div class="form-grid">
                     <div class="input-group">
                        <label for="bloodGroup">Blood Group *</label>
                        <select id="bloodGroup" name="bloodGroup" required>
                            <option value="">-- Select --</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="occupation">Occupation</label>
                        <input type="text" id="occupation" name="occupation" placeholder="e.g., Construction Worker">
                    </div>
                    <div class="input-group full-width">
                        <label for="allergies">Known Allergies (if any)</label>
                        <input type="text" id="allergies" name="allergies" placeholder="e.g., Penicillin, Dust">
                    </div>
                    <div class="input-group full-width">
                        <label for="conditions-input">Pre-existing Conditions (Type a disease and press Enter)</label>
                        <div class="tag-container" id="conditions-container">
                            <input type="text" id="conditions-input" placeholder="e.g., Diabetes, Hypertension...">
                        </div>
                        <input type="hidden" name="preexisting_conditions" id="preexisting_conditions">
                    </div>
                </div>
            </fieldset>

            <div class="form-actions">
                <button type="reset" class="btn btn-secondary">Reset Form</button>
                <button type="submit" class="btn btn-primary">Register Patient</button>
            </div>
        </form>
    </main>

    <script>
        // Auto-calculate age based on Date of Birth
        document.getElementById('dob').addEventListener('change', function() {
            const dob = new Date(this.value);
            if (!isNaN(dob.getTime())) {
                const today = new Date();
                let age = today.getFullYear() - dob.getFullYear();
                const m = today.getMonth() - dob.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                document.getElementById('age').value = age >= 0 ? age : '';
            }
        });

        // Code for disease tags
        const tagContainer = document.getElementById('conditions-container');
        const tagInput = document.getElementById('conditions-input');
        const hiddenInput = document.getElementById('preexisting_conditions');
        let diseases = [];

        function updateTags() {
            tagContainer.querySelectorAll('.tag').forEach(tag => tag.remove());
            diseases.forEach(disease => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('tag');
                tagElement.innerText = disease;
                
                const removeElement = document.createElement('span');
                removeElement.classList.add('remove-tag');
                removeElement.innerText = 'x';
                removeElement.onclick = () => {
                    removeDisease(disease);
                };
                
                tagElement.appendChild(removeElement);
                tagContainer.prepend(tagElement);
            });
            hiddenInput.value = diseases.join(',');
        }

        function removeDisease(diseaseToRemove) {
            diseases = diseases.filter(disease => disease !== diseaseToRemove);
            updateTags();
        }

        tagInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' || event.key === ',') {
                event.preventDefault();
                const newDisease = tagInput.value.trim();
                if (newDisease && !diseases.includes(newDisease)) {
                    diseases.push(newDisease);
                    updateTags();
                }
                tagInput.value = '';
            }
        });
    </script>
</body>
</html>